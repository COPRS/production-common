<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ExtractMetadata.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">S1-PDGS Cloud POC - Metadata catalog</a> &gt; <a href="index.source.html" class="el_package">esa.s1pdgs.cpoc.mdcatalog.extraction.files</a> &gt; <span class="el_source">ExtractMetadata.java</span></div><h1>ExtractMetadata.java</h1><pre class="source lang-java linenums">package esa.s1pdgs.cpoc.mdcatalog.extraction.files;

import java.io.File;
import java.io.IOException;
import java.nio.charset.Charset;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.Map;

import javax.xml.transform.Source;
import javax.xml.transform.Transformer;
import javax.xml.transform.TransformerException;
import javax.xml.transform.TransformerFactory;
import javax.xml.transform.stream.StreamResult;
import javax.xml.transform.stream.StreamSource;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;
import org.json.XML;

import esa.s1pdgs.cpoc.common.errors.processing.MetadataExtractionException;
import esa.s1pdgs.cpoc.mdcatalog.extraction.model.ConfigFileDescriptor;
import esa.s1pdgs.cpoc.mdcatalog.extraction.model.EdrsSessionFileDescriptor;
import esa.s1pdgs.cpoc.mdcatalog.extraction.model.L0OutputFileDescriptor;
import esa.s1pdgs.cpoc.mdcatalog.extraction.model.L1OutputFileDescriptor;

/**
 * Class to extract the metadata from various types of files
 * 
 * @author Olivier Bex-Chauvet
 * 
 */
public class ExtractMetadata {

	/**
	 * XSLT transformer factory
	 */
	private TransformerFactory transFactory;
	/**
	 * Date Format
	 */
	private SimpleDateFormat dateFormat;
	
	/**
	 * Map of all the overlap for the different slice type
	 */
	private Map&lt;String, Float&gt; typeOverlap;
	
	/**
	 * Map of all the length for the different slice type
	 */
	private Map&lt;String, Float&gt; typeSliceLength;
	
	private String xsltDirectory;

	/**
	 * Constructor
	 */
<span class="fc" id="L63">	public ExtractMetadata(Map&lt;String, Float&gt; typeOverlap, Map&lt;String, Float&gt; typeSliceLength, String xsltDirectory) {</span>
<span class="fc" id="L64">		this.transFactory = TransformerFactory.newInstance();</span>
<span class="fc" id="L65">		this.dateFormat = new SimpleDateFormat(&quot;yyyy-MM-dd'T'HH:mm:ss&quot;);</span>
<span class="fc" id="L66">		this.typeOverlap = typeOverlap;</span>
<span class="fc" id="L67">		this.typeSliceLength = typeSliceLength;</span>
<span class="fc" id="L68">		this.xsltDirectory = xsltDirectory;</span>
<span class="fc" id="L69">	}</span>

	/**
	 * Tool function which returns the content of a file
	 * 
	 * @param FileName
	 * @param encoding
	 * 
	 * @return the content of the file
	 * 
	 * @throws IOException
	 */
	private String readFile(String fileName, Charset encoding) throws IOException {
<span class="fc" id="L82">		byte[] encoded = Files.readAllBytes(Paths.get(fileName));</span>
<span class="fc" id="L83">		return new String(encoded, encoding);</span>
	}
	
	/**
	 * Function which transform the raw coordinates in the good format
	 * 
	 * @param rawCoordinates
	 * @param productName
	 * 
	 * @return the coordinates in good format
	 * @throws MetadataExtractionException 
	 */
	private JSONArray processCoordinates(String productName, String rawCoordinates) throws MetadataExtractionException {
<span class="fc" id="L96">		JSONArray coordinates = new JSONArray();</span>
		try {
<span class="fc bfc" id="L98" title="All 2 branches covered.">			for (String coord : rawCoordinates.split(&quot; &quot;)) {</span>
<span class="fc" id="L99">				coordinates.put(new JSONArray(&quot;[&quot; + (coord.split(&quot;,&quot;))[1] + &quot;,&quot; + (coord.split(&quot;,&quot;))[0] + &quot;]&quot;));</span>
			}
<span class="fc bfc" id="L101" title="All 2 branches covered.">			if(!rawCoordinates.split(&quot; &quot;)[0].equals(rawCoordinates.split(&quot; &quot;)[rawCoordinates.split(&quot; &quot;).length-1])) {</span>
<span class="fc" id="L102">				coordinates.put(new JSONArray(&quot;[&quot; + (rawCoordinates.split(&quot; &quot;)[0].split(&quot;,&quot;))[1] + &quot;,&quot; + (rawCoordinates.split(&quot; &quot;)[0].split(&quot;,&quot;))[0] + &quot;]&quot;));</span>
			}
<span class="nc" id="L104">		} catch (JSONException e) {</span>
<span class="nc" id="L105">			throw new MetadataExtractionException(e);</span>
<span class="fc" id="L106">		}</span>
<span class="fc" id="L107">		return new JSONArray().put(coordinates);</span>
	}
	
	/**
	 * Function which return the number of slices in a segment
	 * 
	 * @param startTimeLong
	 * @param stopTimeLong
	 * @param type
	 * 
	 * @return an int which is the number of Slices
	 */
	private int totalNumberOfSlice(Long startTimeLong, Long stopTimeLong, String type) {
<span class="fc" id="L120">		int totalNumberOfSlices = 0;</span>
<span class="fc" id="L121">		float tmpNumberOfSlices = 0F;</span>
<span class="fc" id="L122">		double fracNumberOfSlices = 0.0;</span>
<span class="fc" id="L123">		tmpNumberOfSlices = (stopTimeLong - startTimeLong - this.typeOverlap.get(type))/this.typeSliceLength.get(type);</span>
<span class="fc" id="L124">		fracNumberOfSlices = tmpNumberOfSlices - Math.floor(tmpNumberOfSlices);</span>
<span class="pc bpc" id="L125" title="1 of 2 branches missed.">		if((fracNumberOfSlices*this.typeSliceLength.get(type)) &lt; this.typeOverlap.get(type)){</span>
<span class="nc" id="L126">			totalNumberOfSlices = (int) Math.floor(tmpNumberOfSlices);</span>
		}
		else {
<span class="fc" id="L129">			totalNumberOfSlices = (int) Math.ceil(tmpNumberOfSlices);</span>
		}
<span class="fc" id="L131">		return Math.max(totalNumberOfSlices, 1);</span>
	}

	/**
	 * Function which extracts metadata from MPL EOF file
	 * 
	 * @param descriptor The file descriptor of the auxiliary file
	 * @param file The file containing the metadata
	 * 
	 * @return the json object with extracted metadata
	 * 
	 * @throws MetadataExtractionException
	 */
	public JSONObject processEOFFile(ConfigFileDescriptor descriptor, File file) throws MetadataExtractionException {
		try {
			// XSLT Transformation
<span class="fc" id="L147">			String xsltFilename = this.xsltDirectory + &quot;XSLT_MPL_EOF.xslt&quot;;</span>
<span class="fc" id="L148">			Source xsltMPLEOF = new StreamSource(new File(xsltFilename));</span>
<span class="fc" id="L149">			Transformer transformerMPL = transFactory.newTransformer(xsltMPLEOF);</span>
<span class="fc" id="L150">			Source mplMetadataFile = new StreamSource(file);</span>
<span class="fc" id="L151">			transformerMPL.transform(mplMetadataFile, new StreamResult(new File(&quot;tmp/output.xml&quot;)));</span>
			// JSON creation
<span class="fc" id="L153">			JSONObject jsonFromXmlTmp = XML.toJSONObject(readFile(&quot;tmp/output.xml&quot;, Charset.defaultCharset()));</span>
<span class="fc" id="L154">			JSONObject metadataJSONObject = new JSONObject();</span>
<span class="fc" id="L155">			if (jsonFromXmlTmp.getJSONObject(&quot;validityStopTime&quot;).getString(&quot;content&quot;)</span>
<span class="pc bpc" id="L156" title="1 of 2 branches missed.">					.equals(&quot;UTC=9999-99-99T99:99:99&quot;)) {</span>
<span class="nc" id="L157">				metadataJSONObject.put(&quot;validityStopTime&quot;, &quot;9999-12-31T23:59:59&quot;);</span>
			} else {
<span class="fc" id="L159">				metadataJSONObject.put(&quot;validityStopTime&quot;,</span>
<span class="fc" id="L160">						jsonFromXmlTmp.getJSONObject(&quot;validityStopTime&quot;).get(&quot;content&quot;).toString().substring(4));</span>
			}
<span class="fc" id="L162">			metadataJSONObject.put(&quot;creationTime&quot;,</span>
<span class="fc" id="L163">					jsonFromXmlTmp.getJSONObject(&quot;creationTime&quot;).get(&quot;content&quot;).toString().substring(4));</span>
<span class="fc" id="L164">			metadataJSONObject.put(&quot;validityStartTime&quot;,</span>
<span class="fc" id="L165">					jsonFromXmlTmp.getJSONObject(&quot;validityStartTime&quot;).get(&quot;content&quot;).toString().substring(4));</span>
<span class="fc" id="L166">			metadataJSONObject.put(&quot;version&quot;, jsonFromXmlTmp.getJSONObject(&quot;version&quot;).get(&quot;content&quot;));</span>
<span class="fc" id="L167">			metadataJSONObject.put(&quot;productName&quot;, descriptor.getProductName());</span>
<span class="fc" id="L168">			metadataJSONObject.put(&quot;productClass&quot;, descriptor.getProductClass());</span>
<span class="fc" id="L169">			metadataJSONObject.put(&quot;productType&quot;, descriptor.getProductType());</span>
<span class="fc" id="L170">			metadataJSONObject.put(&quot;missionId&quot;, descriptor.getMissionId());</span>
<span class="fc" id="L171">			metadataJSONObject.put(&quot;satelliteId&quot;, descriptor.getSatelliteId());</span>
<span class="fc" id="L172">			metadataJSONObject.put(&quot;url&quot;, descriptor.getKeyObjectStorage());</span>
<span class="fc" id="L173">			metadataJSONObject.put(&quot;insertionTime&quot;, dateFormat.format(new Date()));</span>
<span class="fc" id="L174">			return metadataJSONObject;</span>
<span class="fc" id="L175">		} catch (IOException | TransformerException | JSONException e) {</span>
<span class="fc" id="L176">			throw new MetadataExtractionException(e);</span>
		}
	}

	/**
	 * Function which extracts metadata from AUX EOF file
	 * 
	 * @param descriptor The file descriptor of the auxiliary file
	 * @param file The file containing the metadata
	 * 
	 * @return the json object with extracted metadata
	 * 
	 * @throws MetadataExtractionException
	 */
	public JSONObject processEOFFileWithoutNamespace(ConfigFileDescriptor descriptor, File file)
			throws MetadataExtractionException {
		try {
			// XSLT Transformation
<span class="fc" id="L194">			String xsltFilename = this.xsltDirectory + &quot;XSLT_AUX_EOF.xslt&quot;;</span>
<span class="fc" id="L195">			Source xsltAUXEOF = new StreamSource(new File(xsltFilename));</span>
<span class="fc" id="L196">			Transformer transformerAUX = transFactory.newTransformer(xsltAUXEOF);</span>
<span class="fc" id="L197">			Source auxMetadataFile = new StreamSource(file);</span>
<span class="fc" id="L198">			transformerAUX.transform(auxMetadataFile, new StreamResult(new File(&quot;tmp/output.xml&quot;)));</span>
			// JSON creation
<span class="fc" id="L200">			JSONObject metadataJSONObject = XML.toJSONObject(readFile(&quot;tmp/output.xml&quot;, Charset.defaultCharset()));</span>
<span class="fc" id="L201">			metadataJSONObject.put(&quot;validityStopTime&quot;, metadataJSONObject.getString(&quot;validityStopTime&quot;).toString()</span>
<span class="fc" id="L202">					.substring(4, metadataJSONObject.getString(&quot;validityStopTime&quot;).toString().length()));</span>
<span class="fc" id="L203">			metadataJSONObject.put(&quot;creationTime&quot;, metadataJSONObject.getString(&quot;creationTime&quot;).toString().substring(4,</span>
<span class="fc" id="L204">					metadataJSONObject.getString(&quot;creationTime&quot;).toString().length()));</span>
<span class="fc" id="L205">			metadataJSONObject.put(&quot;validityStartTime&quot;, metadataJSONObject.getString(&quot;validityStartTime&quot;).toString()</span>
<span class="fc" id="L206">					.substring(4, metadataJSONObject.getString(&quot;validityStartTime&quot;).toString().length()));</span>
<span class="fc" id="L207">			metadataJSONObject.put(&quot;productName&quot;, descriptor.getProductName());</span>
<span class="fc" id="L208">			metadataJSONObject.put(&quot;productClass&quot;, descriptor.getProductClass());</span>
<span class="fc" id="L209">			metadataJSONObject.put(&quot;productType&quot;, descriptor.getProductType());</span>
<span class="fc" id="L210">			metadataJSONObject.put(&quot;missionId&quot;, descriptor.getMissionId());</span>
<span class="fc" id="L211">			metadataJSONObject.put(&quot;satelliteId&quot;, descriptor.getSatelliteId());</span>
<span class="fc" id="L212">			metadataJSONObject.put(&quot;url&quot;, descriptor.getKeyObjectStorage());</span>
<span class="fc" id="L213">			metadataJSONObject.put(&quot;insertionTime&quot;, dateFormat.format(new Date()));</span>
<span class="fc" id="L214">			return metadataJSONObject;</span>
<span class="fc" id="L215">		} catch (IOException | TransformerException | JSONException e) {</span>
<span class="fc" id="L216">			throw new MetadataExtractionException(e);</span>
		}
	}

	/**
	 * Function which extracts metadata from AUX XML file
	 * 
	 * @param descriptor The file descriptor of the auxiliary file
	 * @param file The file containing the metadata
	 * 
	 * @return the json object with extracted metadata
	 * 
	 * @throws MetadataExtractionException
	 */
	public JSONObject processXMLFile(ConfigFileDescriptor descriptor, File file) throws MetadataExtractionException {
		try {
			// XSLT Transformation
<span class="fc" id="L233">			String xsltFilename = this.xsltDirectory + &quot;XSLT_AUX_XML.xslt&quot;;</span>
<span class="fc" id="L234">			Source xsltAUXXML = new StreamSource(new File(xsltFilename));</span>
<span class="fc" id="L235">			Transformer transformerAUX = transFactory.newTransformer(xsltAUXXML);</span>
<span class="fc" id="L236">			Source auxMetadataFile = new StreamSource(file);</span>
<span class="fc" id="L237">			transformerAUX.transform(auxMetadataFile, new StreamResult(new File(&quot;tmp/output.xml&quot;)));</span>
			// JSON creation
<span class="fc" id="L239">			JSONObject metadataJSONObject = XML.toJSONObject(readFile(&quot;tmp/output.xml&quot;, Charset.defaultCharset()));</span>
<span class="fc bfc" id="L240" title="All 2 branches covered.">			if (metadataJSONObject.getString(&quot;validityStopTime&quot;).equals(&quot;UTC=9999-99-99T99:99:99&quot;)) {</span>
<span class="fc" id="L241">				metadataJSONObject.put(&quot;validityStopTime&quot;, &quot;9999-12-31T23:59:59&quot;);</span>
			} else {
<span class="fc" id="L243">				metadataJSONObject.put(&quot;validityStopTime&quot;, metadataJSONObject.getString(&quot;validityStopTime&quot;).substring(4));</span>
			}
<span class="pc bpc" id="L245" title="1 of 2 branches missed.">			if(metadataJSONObject.getString(&quot;validityStartTime&quot;).substring(0, 4).equals(&quot;UTC=&quot;)) {</span>
<span class="fc" id="L246">				metadataJSONObject.put(&quot;validityStartTime&quot;, metadataJSONObject.getString(&quot;validityStartTime&quot;).substring(4));</span>
			}
<span class="pc bpc" id="L248" title="1 of 2 branches missed.">			if(metadataJSONObject.getString(&quot;creationTime&quot;).substring(0, 4).equals(&quot;UTC=&quot;)) {</span>
<span class="fc" id="L249">				metadataJSONObject.put(&quot;creationTime&quot;, metadataJSONObject.getString(&quot;creationTime&quot;).substring(4));</span>
			}
<span class="fc" id="L251">			metadataJSONObject.put(&quot;productName&quot;, descriptor.getProductName());</span>
<span class="fc" id="L252">			metadataJSONObject.put(&quot;productClass&quot;, descriptor.getProductClass());</span>
<span class="fc" id="L253">			metadataJSONObject.put(&quot;productType&quot;, descriptor.getProductType());</span>
<span class="fc" id="L254">			metadataJSONObject.put(&quot;missionId&quot;, descriptor.getMissionId());</span>
<span class="fc" id="L255">			metadataJSONObject.put(&quot;satelliteId&quot;, descriptor.getSatelliteId());</span>
<span class="fc" id="L256">			metadataJSONObject.put(&quot;url&quot;, descriptor.getKeyObjectStorage());</span>
<span class="fc" id="L257">			metadataJSONObject.put(&quot;insertionTime&quot;, dateFormat.format(new Date()));</span>
<span class="fc" id="L258">			return metadataJSONObject;</span>

<span class="fc" id="L260">		} catch (IOException | TransformerException | JSONException e) {</span>
<span class="fc" id="L261">			throw new MetadataExtractionException(e);</span>
		}
	}

	/**
	 * Function which extracts metadata from AUX MANIFEST file
	 * 
	 * @param descriptor The file descriptor of the auxiliary file
	 * @param file The file containing the metadata
	 * 
	 * @return the json object with extracted metadata
	 * 
	 * @throws MetadataExtractionException
	 */
	public JSONObject processSAFEFile(ConfigFileDescriptor descriptor, File file) throws MetadataExtractionException {
		try {
			// XSLT Transformation
<span class="fc" id="L278">			String xsltFilename = this.xsltDirectory + &quot;XSLT_AUX_MANIFEST.xslt&quot;;</span>
<span class="fc" id="L279">			Source xsltAUXMANIFEST = new StreamSource(new File(xsltFilename));</span>
<span class="fc" id="L280">			Transformer transformerAUX = transFactory.newTransformer(xsltAUXMANIFEST);</span>
<span class="fc" id="L281">			Source auxMetadataFile = new StreamSource(file);</span>
<span class="fc" id="L282">			transformerAUX.transform(auxMetadataFile, new StreamResult(new File(&quot;tmp/output.xml&quot;)));</span>
			// JSON creation
<span class="fc" id="L284">			JSONObject jsonFromXmlTmp = XML.toJSONObject(readFile(&quot;tmp/output.xml&quot;, Charset.defaultCharset()));</span>
<span class="fc" id="L285">			JSONObject metadataJSONObject = new JSONObject();</span>
<span class="fc" id="L286">			metadataJSONObject.put(&quot;site&quot;, jsonFromXmlTmp.getJSONObject(&quot;site&quot;).getString(&quot;site&quot;));</span>
<span class="fc" id="L287">			metadataJSONObject.put(&quot;instrumentConfigurationId&quot;,</span>
<span class="fc" id="L288">					jsonFromXmlTmp.getJSONObject(&quot;instrumentConfigurationId&quot;).get(&quot;content&quot;));</span>
<span class="fc" id="L289">			metadataJSONObject.put(&quot;creationTime&quot;, jsonFromXmlTmp.getJSONObject(&quot;creationTime&quot;).getString(&quot;content&quot;));</span>
<span class="fc" id="L290">			metadataJSONObject.put(&quot;validityStartTime&quot;,</span>
<span class="fc" id="L291">					jsonFromXmlTmp.getJSONObject(&quot;validityStartTime&quot;).getString(&quot;content&quot;));</span>
<span class="fc" id="L292">			metadataJSONObject.put(&quot;validityStopTime&quot;, &quot;9999-12-31T23:59:59&quot;);</span>
<span class="fc" id="L293">			metadataJSONObject.put(&quot;productName&quot;, descriptor.getProductName());</span>
<span class="fc" id="L294">			metadataJSONObject.put(&quot;productType&quot;, descriptor.getProductType());</span>
<span class="fc" id="L295">			metadataJSONObject.put(&quot;missionId&quot;, descriptor.getMissionId());</span>
<span class="fc" id="L296">			metadataJSONObject.put(&quot;satelliteId&quot;, descriptor.getSatelliteId());</span>
<span class="fc" id="L297">			metadataJSONObject.put(&quot;url&quot;, descriptor.getKeyObjectStorage());</span>
<span class="fc" id="L298">			metadataJSONObject.put(&quot;insertionTime&quot;, dateFormat.format(new Date()));</span>
<span class="fc" id="L299">			return metadataJSONObject;</span>
<span class="fc" id="L300">		} catch (IOException | TransformerException | JSONException e) {</span>
<span class="fc" id="L301">			throw new MetadataExtractionException(e);</span>
		}
	}

	/**
	 * Function which extracts metadata from RAW file
	 * 
	 * @param descriptor The file descriptor of the raw file
	 * 
	 * @return the json object with extracted metadata
	 * 
	 * @throws MetadataExtractionException
	 */
	public JSONObject processRAWFile(EdrsSessionFileDescriptor descriptor) throws MetadataExtractionException {
		try {
<span class="fc" id="L316">			JSONObject metadataJSONObject = new JSONObject();</span>
<span class="fc" id="L317">			metadataJSONObject.put(&quot;productName&quot;, descriptor.getProductName());</span>
<span class="fc" id="L318">			metadataJSONObject.put(&quot;productType&quot;, descriptor.getProductType());</span>
<span class="fc" id="L319">			metadataJSONObject.put(&quot;sessionId&quot;, descriptor.getSessionIdentifier());</span>
<span class="fc" id="L320">			metadataJSONObject.put(&quot;missionId&quot;, descriptor.getMissionId());</span>
<span class="fc" id="L321">			metadataJSONObject.put(&quot;satelliteId&quot;, descriptor.getSatelliteId());</span>
<span class="fc" id="L322">			metadataJSONObject.put(&quot;url&quot;, descriptor.getKeyObjectStorage());</span>
<span class="fc" id="L323">			metadataJSONObject.put(&quot;insertionTime&quot;, dateFormat.format(new Date()));</span>
<span class="fc" id="L324">			return metadataJSONObject;</span>
<span class="nc" id="L325">		} catch (JSONException e) {</span>
<span class="nc" id="L326">			throw new MetadataExtractionException(e);</span>
		}
	}

	/**
	 * Function which extracts metadata from SESSION file
	 * 
	 * @param descriptor The file descriptor of the session file
	 * 
	 * @return the json object with extracted metadata
	 * 
	 * @throws MetadataExtractionException
	 */
	public JSONObject processSESSIONFile(EdrsSessionFileDescriptor descriptor) throws MetadataExtractionException {
		try {
<span class="fc" id="L341">			JSONObject metadataJSONObject = new JSONObject();</span>
<span class="fc" id="L342">			metadataJSONObject.put(&quot;productName&quot;, descriptor.getProductName());</span>
<span class="fc" id="L343">			metadataJSONObject.put(&quot;productType&quot;, descriptor.getProductType());</span>
<span class="fc" id="L344">			metadataJSONObject.put(&quot;sessionId&quot;, descriptor.getSessionIdentifier());</span>
<span class="fc" id="L345">			metadataJSONObject.put(&quot;missionId&quot;, descriptor.getMissionId());</span>
<span class="fc" id="L346">			metadataJSONObject.put(&quot;satelliteId&quot;, descriptor.getSatelliteId());</span>
<span class="fc" id="L347">			metadataJSONObject.put(&quot;url&quot;, descriptor.getKeyObjectStorage());</span>
<span class="fc" id="L348">			metadataJSONObject.put(&quot;insertionTime&quot;, dateFormat.format(new Date()));</span>
<span class="fc" id="L349">			return metadataJSONObject;</span>
<span class="nc" id="L350">		} catch (JSONException e) {</span>
<span class="nc" id="L351">			throw new MetadataExtractionException(e);</span>
		}
	}
	
	public JSONObject processL0SliceProd(L0OutputFileDescriptor descriptor, File file) throws MetadataExtractionException {
<span class="fc" id="L356">		return this.processL0Prod(descriptor, file, &quot;tmp/outputl0slices.xml&quot;);</span>
	}
	
	public JSONObject processL0AcnProd(L0OutputFileDescriptor descriptor, File file) throws MetadataExtractionException {
<span class="fc" id="L360">		return this.processL0Prod(descriptor, file, &quot;tmp/outputl0acns.xml&quot;);</span>
	}
	
	/**
	 * Function which extracts metadata from L0 product
	 * 
	 * @param descriptor
	 * @param file
	 * @param output
	 * 
	 * @return the json object with extracted metadata
	 * 
	 * @throws MetadataExtractionException
	 */
	private JSONObject processL0Prod(L0OutputFileDescriptor descriptor, File file, String output) throws MetadataExtractionException {
		try {
			//XSLT Transformation
<span class="fc" id="L377">			String xsltFilename = this.xsltDirectory + &quot;XSLT_L0_MANIFEST.xslt&quot;;</span>
<span class="fc" id="L378">			Source xsltL1MANIFEST = new StreamSource(new File(xsltFilename));</span>
<span class="fc" id="L379">	        Transformer transformerL0 = transFactory.newTransformer(xsltL1MANIFEST);</span>
<span class="fc" id="L380">	        Source l1File = new StreamSource(file);</span>
<span class="fc" id="L381">	        transformerL0.transform(l1File, new StreamResult(new File(output)));</span>
	        //JSON creation
<span class="fc" id="L383">	        JSONObject jsonFromXmlTmp = XML.toJSONObject(readFile(output, Charset.defaultCharset()));</span>
<span class="fc" id="L384">	        JSONObject metadataJSONObject = new JSONObject();</span>
<span class="pc bpc" id="L385" title="1 of 2 branches missed.">	        if(jsonFromXmlTmp.getJSONObject(&quot;missionDataTakeId&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L386">	        	metadataJSONObject.put(&quot;missionDataTakeId&quot;, jsonFromXmlTmp.getJSONObject(&quot;missionDataTakeId&quot;).get(&quot;content&quot;));</span>
	        }
<span class="fc bfc" id="L388" title="All 2 branches covered.">	        if(jsonFromXmlTmp.getJSONObject(&quot;theoreticalSliceLength&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L389">	        	metadataJSONObject.put(&quot;theoreticalSliceLength&quot;, jsonFromXmlTmp.getJSONObject(&quot;theoreticalSliceLength&quot;).get(&quot;content&quot;));</span>
	        }
<span class="pc bpc" id="L391" title="1 of 2 branches missed.">	        if(jsonFromXmlTmp.getJSONObject(&quot;pass&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L392">	        	metadataJSONObject.put(&quot;pass&quot;, jsonFromXmlTmp.getJSONObject(&quot;pass&quot;).get(&quot;content&quot;));</span>
	        }
<span class="pc bpc" id="L394" title="1 of 2 branches missed.">	        if(jsonFromXmlTmp.getJSONObject(&quot;stopTimeANX&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L395">	        	metadataJSONObject.put(&quot;stopTimeANX&quot;, jsonFromXmlTmp.getJSONObject(&quot;stopTimeANX&quot;).get(&quot;content&quot;));</span>
	        }
<span class="pc bpc" id="L397" title="1 of 2 branches missed.">	        if(jsonFromXmlTmp.getJSONObject(&quot;sliceCoordinates&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L398">	        	JSONObject coordinates = new JSONObject();</span>
<span class="fc" id="L399">	        	coordinates.put(&quot;type&quot;, &quot;polygon&quot;);</span>
<span class="fc" id="L400">	        	coordinates.put(&quot;coordinates&quot;, processCoordinates(descriptor.getProductName(), jsonFromXmlTmp.getJSONObject(&quot;sliceCoordinates&quot;).getString(&quot;content&quot;)));</span>
<span class="fc" id="L401">	        	metadataJSONObject.put(&quot;sliceCoordinates&quot;, coordinates);       	</span>
	        }
<span class="fc bfc" id="L403" title="All 2 branches covered.">	        if(jsonFromXmlTmp.getJSONObject(&quot;sliceNumber&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L404">	        	metadataJSONObject.put(&quot;sliceNumber&quot;, jsonFromXmlTmp.getJSONObject(&quot;sliceNumber&quot;).get(&quot;content&quot;));</span>
	        }
<span class="pc bpc" id="L406" title="1 of 2 branches missed.">	        if(jsonFromXmlTmp.getJSONObject(&quot;absoluteStopOrbit&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L407">	        	metadataJSONObject.put(&quot;absoluteStopOrbit&quot;, jsonFromXmlTmp.getJSONObject(&quot;absoluteStopOrbit&quot;).get(&quot;content&quot;));</span>
	        }
<span class="pc bpc" id="L409" title="1 of 2 branches missed.">	        if(jsonFromXmlTmp.getJSONObject(&quot;circulationFlag&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L410">	        	metadataJSONObject.put(&quot;circulationFlag&quot;, jsonFromXmlTmp.getJSONObject(&quot;circulationFlag&quot;).get(&quot;content&quot;));</span>
	        }
<span class="pc bpc" id="L412" title="1 of 2 branches missed.">	        if(jsonFromXmlTmp.getJSONObject(&quot;productConsolidation&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L413">	        	metadataJSONObject.put(&quot;productConsolidation&quot;, jsonFromXmlTmp.getJSONObject(&quot;productConsolidation&quot;).get(&quot;content&quot;));</span>
	        }
<span class="pc bpc" id="L415" title="1 of 2 branches missed.">	        if(jsonFromXmlTmp.getJSONObject(&quot;absoluteStartOrbit&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L416">	        	metadataJSONObject.put(&quot;absoluteStartOrbit&quot;, jsonFromXmlTmp.getJSONObject(&quot;absoluteStartOrbit&quot;).get(&quot;content&quot;));</span>
	        }
<span class="pc bpc" id="L418" title="1 of 2 branches missed.">	        if(jsonFromXmlTmp.getJSONObject(&quot;instrumentConfigurationId&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L419">	        	metadataJSONObject.put(&quot;instrumentConfigurationId&quot;, jsonFromXmlTmp.getJSONObject(&quot;instrumentConfigurationId&quot;).get(&quot;content&quot;));</span>
	        }
<span class="fc bfc" id="L421" title="All 2 branches covered.">	        if(jsonFromXmlTmp.getJSONObject(&quot;sliceOverlap&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L422">	        	metadataJSONObject.put(&quot;sliceOverlap&quot;, jsonFromXmlTmp.getJSONObject(&quot;sliceOverlap&quot;).get(&quot;content&quot;));</span>
	        }
<span class="pc bpc" id="L424" title="1 of 2 branches missed.">	        if(jsonFromXmlTmp.getJSONObject(&quot;startTimeANX&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L425">	        	metadataJSONObject.put(&quot;startTimeANX&quot;, jsonFromXmlTmp.getJSONObject(&quot;startTimeANX&quot;).get(&quot;content&quot;));</span>
	        }
<span class="pc bpc" id="L427" title="1 of 2 branches missed.">	        if(jsonFromXmlTmp.getJSONObject(&quot;relativeStopOrbit&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L428">	        	metadataJSONObject.put(&quot;relativeStopOrbit&quot;, jsonFromXmlTmp.getJSONObject(&quot;relativeStopOrbit&quot;).get(&quot;content&quot;));</span>
	        }
<span class="pc bpc" id="L430" title="1 of 2 branches missed.">	        if(jsonFromXmlTmp.getJSONObject(&quot;relativeStartOrbit&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L431">	        	metadataJSONObject.put(&quot;relativeStartOrbit&quot;, jsonFromXmlTmp.getJSONObject(&quot;relativeStartOrbit&quot;).get(&quot;content&quot;));</span>
	        }
<span class="pc bpc" id="L433" title="1 of 2 branches missed.">	        if(jsonFromXmlTmp.getJSONObject(&quot;startTime&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L434">	        	metadataJSONObject.put(&quot;startTime&quot;, jsonFromXmlTmp.getJSONObject(&quot;startTime&quot;).getString(&quot;content&quot;));</span>
<span class="fc" id="L435">	        	metadataJSONObject.put(&quot;validityStartTime&quot;, jsonFromXmlTmp.getJSONObject(&quot;startTime&quot;).getString(&quot;content&quot;));</span>
	        }
<span class="pc bpc" id="L437" title="1 of 2 branches missed.">	        if(jsonFromXmlTmp.getJSONObject(&quot;stopTime&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L438">	        	metadataJSONObject.put(&quot;stopTime&quot;, jsonFromXmlTmp.getJSONObject(&quot;stopTime&quot;).getString(&quot;content&quot;));</span>
<span class="fc" id="L439">	        	metadataJSONObject.put(&quot;validityStopTime&quot;, jsonFromXmlTmp.getJSONObject(&quot;stopTime&quot;).getString(&quot;content&quot;));</span>
	        }
<span class="pc bpc" id="L441" title="1 of 6 branches missed.">	        if(descriptor.getProductClass().equals(&quot;A&quot;) || descriptor.getProductClass().equals(&quot;C&quot;) || descriptor.getProductClass().equals(&quot;N&quot;)) {</span>
<span class="pc bpc" id="L442" title="2 of 4 branches missed.">	        	if(metadataJSONObject.has(&quot;startTime&quot;) &amp;&amp; metadataJSONObject.has(&quot;stopTime&quot;)) {</span>
<span class="fc bfc" id="L443" title="All 2 branches covered.">	        		if(descriptor.getSwathtype().matches(&quot;IW&quot;)) {</span>
<span class="fc" id="L444">	            		metadataJSONObject.put(&quot;totalNumberOfSlice&quot;, </span>
<span class="fc" id="L445">							totalNumberOfSlice(</span>
<span class="fc" id="L446">									dateFormat.parse(jsonFromXmlTmp.getJSONObject(&quot;startTime&quot;).getString(&quot;content&quot;)).getTime()/1000, </span>
<span class="fc" id="L447">									dateFormat.parse(jsonFromXmlTmp.getJSONObject(&quot;stopTime&quot;).getString(&quot;content&quot;)).getTime()/1000,</span>
<span class="fc" id="L448">									descriptor.getSwathtype()));</span>
	        		}	
<span class="pc bpc" id="L450" title="1 of 2 branches missed.">		        	else if (descriptor.getSwathtype().matches(&quot;EW&quot;)) {</span>
<span class="fc" id="L451">						metadataJSONObject.put(&quot;totalNumberOfSlice&quot;, </span>
<span class="fc" id="L452">								totalNumberOfSlice(</span>
<span class="fc" id="L453">										dateFormat.parse(jsonFromXmlTmp.getJSONObject(&quot;startTime&quot;).getString(&quot;content&quot;)).getTime()/1000, </span>
<span class="fc" id="L454">										dateFormat.parse(jsonFromXmlTmp.getJSONObject(&quot;stopTime&quot;).getString(&quot;content&quot;)).getTime()/1000,</span>
<span class="fc" id="L455">										descriptor.getSwathtype()));</span>
		        	}
<span class="nc bnc" id="L457" title="All 2 branches missed.">		        	else if (descriptor.getSwathtype().matches(&quot;WM&quot;)) {</span>
<span class="nc" id="L458">						metadataJSONObject.put(&quot;totalNumberOfSlice&quot;, </span>
<span class="nc" id="L459">								totalNumberOfSlice(</span>
<span class="nc" id="L460">										dateFormat.parse(jsonFromXmlTmp.getJSONObject(&quot;startTime&quot;).getString(&quot;content&quot;)).getTime()/1000, </span>
<span class="nc" id="L461">										dateFormat.parse(jsonFromXmlTmp.getJSONObject(&quot;stopTime&quot;).getString(&quot;content&quot;)).getTime()/1000,</span>
<span class="nc" id="L462">										descriptor.getSwathtype()));</span>
	
		        	}
<span class="nc bnc" id="L465" title="All 2 branches missed.">		        	else if (descriptor.getSwathtype().matches(&quot;S[1-6]&quot;)) {</span>
<span class="nc" id="L466">						metadataJSONObject.put(&quot;totalNumberOfSlice&quot;, </span>
<span class="nc" id="L467">								totalNumberOfSlice(</span>
<span class="nc" id="L468">										dateFormat.parse(jsonFromXmlTmp.getJSONObject(&quot;startTime&quot;).getString(&quot;content&quot;)).getTime()/1000, </span>
<span class="nc" id="L469">										dateFormat.parse(jsonFromXmlTmp.getJSONObject(&quot;stopTime&quot;).getString(&quot;content&quot;)).getTime()/1000,</span>
										&quot;SM&quot;));
		        	}
	        	}
	        }
<span class="fc" id="L474">	        metadataJSONObject.put(&quot;productName&quot;, descriptor.getProductName());</span>
<span class="fc" id="L475">	        metadataJSONObject.put(&quot;productClass&quot;, descriptor.getProductClass());</span>
<span class="fc" id="L476">	        metadataJSONObject.put(&quot;productType&quot;, descriptor.getProductType());</span>
<span class="fc" id="L477">	        metadataJSONObject.put(&quot;resolution&quot;, descriptor.getResolution());</span>
<span class="fc" id="L478">	        metadataJSONObject.put(&quot;missionId&quot;, descriptor.getMissionId());</span>
<span class="fc" id="L479">	        metadataJSONObject.put(&quot;satelliteId&quot;, descriptor.getSatelliteId());</span>
<span class="fc" id="L480">	        metadataJSONObject.put(&quot;swathtype&quot;, descriptor.getSwathtype());</span>
<span class="fc" id="L481">	        metadataJSONObject.put(&quot;polarisation&quot;, descriptor.getPolarisation());</span>
<span class="fc" id="L482">	        metadataJSONObject.put(&quot;dataTakeId&quot;, descriptor.getDataTakeId());</span>
<span class="fc" id="L483">	        metadataJSONObject.put(&quot;url&quot;, descriptor.getKeyObjectStorage());</span>
<span class="fc" id="L484">	        String dt = dateFormat.format(new Date());</span>
<span class="fc" id="L485">	        metadataJSONObject.put(&quot;insertionTime&quot;, dt);</span>
<span class="fc" id="L486">	        metadataJSONObject.put(&quot;creationTime&quot;, dt);</span>
<span class="fc" id="L487">	        return metadataJSONObject;</span>
<span class="fc" id="L488">		} catch (IOException | TransformerException | JSONException | ParseException e) {</span>
<span class="fc" id="L489">			throw new MetadataExtractionException(e);</span>
		}
	}
	
	public JSONObject processL1SliceProd(L1OutputFileDescriptor descriptor, File file) throws MetadataExtractionException {
<span class="fc" id="L494">		return this.processL1Prod(descriptor, file, &quot;tmp/outputl1slices.xml&quot;);</span>
	}
	
	public JSONObject processL1AProd(L1OutputFileDescriptor descriptor, File file) throws MetadataExtractionException {
<span class="fc" id="L498">		return this.processL1Prod(descriptor, file, &quot;tmp/outputl1a.xml&quot;);</span>
	}
	
	/**
	 * Function which extracts metadata from L1 product
	 * 
	 * @param descriptor
	 * @param file
	 * @param output
	 * 
	 * @return the json object with extracted metadata
	 * 
	 * @throws MetadataExtractionException
	 */
	private JSONObject processL1Prod(L1OutputFileDescriptor descriptor, File file, String output)
			throws MetadataExtractionException {
		try {
			//XSLT Transformation
<span class="fc" id="L516">			String xsltFilename = this.xsltDirectory + &quot;XSLT_L1_MANIFEST.xslt&quot;;</span>
<span class="fc" id="L517">			Source xsltL1MANIFEST = new StreamSource(new File(xsltFilename));</span>
<span class="fc" id="L518">	        Transformer transformerL1 = transFactory.newTransformer(xsltL1MANIFEST);</span>
<span class="fc" id="L519">	        Source l1File = new StreamSource(file);</span>
<span class="fc" id="L520">	        transformerL1.transform(l1File, new StreamResult(new File(output)));</span>
	        //JSON creation
<span class="fc" id="L522">	        JSONObject jsonFromXmlTmp = XML.toJSONObject(readFile(output, Charset.defaultCharset()));</span>
<span class="fc" id="L523">	        JSONObject metadataJSONObject = new JSONObject();</span>
<span class="fc bfc" id="L524" title="All 2 branches covered.">	        if(jsonFromXmlTmp.getJSONObject(&quot;missionDataTakeId&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L525">	        	metadataJSONObject.put(&quot;missionDataTakeId&quot;, jsonFromXmlTmp.getJSONObject(&quot;missionDataTakeId&quot;).get(&quot;content&quot;));</span>
	        }
<span class="pc bpc" id="L527" title="1 of 2 branches missed.">	        if(jsonFromXmlTmp.getJSONObject(&quot;pass&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L528">	        	metadataJSONObject.put(&quot;pass&quot;, jsonFromXmlTmp.getJSONObject(&quot;pass&quot;).get(&quot;content&quot;));</span>
	        }
<span class="pc bpc" id="L530" title="1 of 2 branches missed.">	        if(jsonFromXmlTmp.getJSONObject(&quot;stopTimeANX&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L531">	        	metadataJSONObject.put(&quot;stopTimeANX&quot;, jsonFromXmlTmp.getJSONObject(&quot;stopTimeANX&quot;).get(&quot;content&quot;));</span>
	        }
<span class="pc bpc" id="L533" title="1 of 2 branches missed.">	        if(jsonFromXmlTmp.getJSONObject(&quot;sliceCoordinates&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L534">	        	JSONObject coordinates = new JSONObject();</span>
<span class="fc" id="L535">	        	coordinates.put(&quot;type&quot;, &quot;polygon&quot;);</span>
<span class="fc" id="L536">	        	coordinates.put(&quot;coordinates&quot;, processCoordinates(descriptor.getProductName(), jsonFromXmlTmp.getJSONObject(&quot;sliceCoordinates&quot;).getString(&quot;content&quot;)));</span>
<span class="fc" id="L537">	        	metadataJSONObject.put(&quot;sliceCoordinates&quot;, coordinates);       	</span>
	        }
<span class="fc bfc" id="L539" title="All 2 branches covered.">	        if(jsonFromXmlTmp.getJSONObject(&quot;sliceNumber&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L540">	        	metadataJSONObject.put(&quot;sliceNumber&quot;, jsonFromXmlTmp.getJSONObject(&quot;sliceNumber&quot;).get(&quot;content&quot;));</span>
	        }
<span class="fc bfc" id="L542" title="All 2 branches covered.">	        if(jsonFromXmlTmp.getJSONObject(&quot;missionDataTakeId&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L543">	        	metadataJSONObject.put(&quot;missionDataTakeId&quot;, jsonFromXmlTmp.getJSONObject(&quot;missionDataTakeId&quot;).get(&quot;content&quot;));</span>
	        }
<span class="fc bfc" id="L545" title="All 2 branches covered.">	        if(jsonFromXmlTmp.getJSONObject(&quot;sliceNumber&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L546">	        	metadataJSONObject.put(&quot;sliceNumber&quot;, jsonFromXmlTmp.getJSONObject(&quot;sliceNumber&quot;).get(&quot;content&quot;));</span>
	        }
<span class="pc bpc" id="L548" title="1 of 2 branches missed.">	        if(jsonFromXmlTmp.getJSONObject(&quot;absoluteStopOrbit&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L549">	        	metadataJSONObject.put(&quot;absoluteStopOrbit&quot;, jsonFromXmlTmp.getJSONObject(&quot;absoluteStopOrbit&quot;).get(&quot;content&quot;));</span>
	        }
<span class="pc bpc" id="L551" title="1 of 2 branches missed.">	        if(jsonFromXmlTmp.getJSONObject(&quot;absoluteStartOrbit&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L552">	        	metadataJSONObject.put(&quot;absoluteStartOrbit&quot;, jsonFromXmlTmp.getJSONObject(&quot;absoluteStartOrbit&quot;).get(&quot;content&quot;));</span>
	        }
<span class="fc bfc" id="L554" title="All 2 branches covered.">	        if(jsonFromXmlTmp.getJSONObject(&quot;instrumentConfigurationId&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L555">	        	metadataJSONObject.put(&quot;instrumentConfigurationId&quot;, jsonFromXmlTmp.getJSONObject(&quot;instrumentConfigurationId&quot;).get(&quot;content&quot;));</span>
	        }
<span class="pc bpc" id="L557" title="1 of 2 branches missed.">	        if(jsonFromXmlTmp.getJSONObject(&quot;startTimeANX&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L558">	        	metadataJSONObject.put(&quot;startTimeANX&quot;, jsonFromXmlTmp.getJSONObject(&quot;startTimeANX&quot;).get(&quot;content&quot;));</span>
	        }
<span class="pc bpc" id="L560" title="1 of 2 branches missed.">	        if(jsonFromXmlTmp.getJSONObject(&quot;relativeStopOrbit&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L561">	        	metadataJSONObject.put(&quot;relativeStopOrbit&quot;, jsonFromXmlTmp.getJSONObject(&quot;relativeStopOrbit&quot;).get(&quot;content&quot;));</span>
	        }
<span class="pc bpc" id="L563" title="1 of 2 branches missed.">	        if(jsonFromXmlTmp.getJSONObject(&quot;relativeStartOrbit&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L564">	        	metadataJSONObject.put(&quot;relativeStartOrbit&quot;, jsonFromXmlTmp.getJSONObject(&quot;relativeStartOrbit&quot;).get(&quot;content&quot;));</span>
	        }
<span class="pc bpc" id="L566" title="1 of 2 branches missed.">	        if(jsonFromXmlTmp.getJSONObject(&quot;startTime&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L567">	        	metadataJSONObject.put(&quot;startTime&quot;, jsonFromXmlTmp.getJSONObject(&quot;startTime&quot;).getString(&quot;content&quot;));</span>
<span class="fc" id="L568">	        	metadataJSONObject.put(&quot;validityStartTime&quot;, jsonFromXmlTmp.getJSONObject(&quot;startTime&quot;).getString(&quot;content&quot;));</span>
	        }
<span class="pc bpc" id="L570" title="1 of 2 branches missed.">	        if(jsonFromXmlTmp.getJSONObject(&quot;stopTime&quot;).has(&quot;content&quot;)) {</span>
<span class="fc" id="L571">	        	metadataJSONObject.put(&quot;stopTime&quot;, jsonFromXmlTmp.getJSONObject(&quot;stopTime&quot;).getString(&quot;content&quot;));</span>
<span class="fc" id="L572">	        	metadataJSONObject.put(&quot;validityStopTime&quot;, jsonFromXmlTmp.getJSONObject(&quot;stopTime&quot;).getString(&quot;content&quot;));</span>
	        }
<span class="fc" id="L574">	        metadataJSONObject.put(&quot;productName&quot;, descriptor.getProductName());</span>
<span class="fc" id="L575">	        metadataJSONObject.put(&quot;productClass&quot;, descriptor.getProductClass());</span>
<span class="fc" id="L576">	        metadataJSONObject.put(&quot;productType&quot;, descriptor.getProductType());</span>
<span class="fc" id="L577">	        metadataJSONObject.put(&quot;resolution&quot;, descriptor.getResolution());</span>
<span class="fc" id="L578">	        metadataJSONObject.put(&quot;missionId&quot;, descriptor.getMissionId());</span>
<span class="fc" id="L579">	        metadataJSONObject.put(&quot;satelliteId&quot;, descriptor.getSatelliteId());</span>
<span class="fc" id="L580">	        metadataJSONObject.put(&quot;swathtype&quot;, descriptor.getSwathtype());</span>
<span class="fc" id="L581">	        metadataJSONObject.put(&quot;polarisation&quot;, descriptor.getPolarisation());</span>
<span class="fc" id="L582">	        metadataJSONObject.put(&quot;dataTakeId&quot;, descriptor.getDataTakeId());</span>
<span class="fc" id="L583">	        metadataJSONObject.put(&quot;url&quot;, descriptor.getKeyObjectStorage());</span>
<span class="fc" id="L584">	        String dt = dateFormat.format(new Date());</span>
<span class="fc" id="L585">	        metadataJSONObject.put(&quot;insertionTime&quot;, dt);</span>
<span class="fc" id="L586">	        metadataJSONObject.put(&quot;creationTime&quot;, dt);</span>
<span class="fc" id="L587">	        return metadataJSONObject;</span>
<span class="fc" id="L588">		} catch (IOException | TransformerException | JSONException e) {</span>
<span class="fc" id="L589">			throw new MetadataExtractionException(e);</span>
		}	
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>