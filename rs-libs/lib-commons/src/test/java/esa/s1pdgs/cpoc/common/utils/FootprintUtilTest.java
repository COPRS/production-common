package esa.s1pdgs.cpoc.common.utils;

import static org.junit.Assert.assertTrue;
import static org.junit.jupiter.api.Assertions.assertEquals;

import org.junit.Test;

public class FootprintUtilTest {

	@Test
	public void testWhenCrossingAndNotCrossingInterpretationsHaveTheSameWidth_ShallHaveCounterclockwiseOrientation() {
		assertTrue("counterclockwise".equals(
				FootprintUtil.elasticsearchPolygonOrientation(new Double[]{-90.0, 90.0, 90.0, -90.0})));
		assertTrue("counterclockwise".equals(
				FootprintUtil.elasticsearchPolygonOrientation(new Double[]{179.0, -1.0, -1.0, 179.0})));
		assertTrue("counterclockwise".equals(
				FootprintUtil.elasticsearchPolygonOrientation(new Double[]{-179.0, 1.0, 1.0, -179.0})));
	}

	@Test
	public void testWhenDatelineNotCrossed_ShallHaveCounterclockwiseOrientation1() {
		assertTrue("counterclockwise".equals(
				FootprintUtil.elasticsearchPolygonOrientation(new Double[]{179.0, 170.0, 150.0, 170.0})));
		assertTrue("counterclockwise".equals(
				FootprintUtil.elasticsearchPolygonOrientation(new Double[]{-179.0, -170.0, -150.0, -170.0})));
	}

	@Test
	public void testWhenDatelineNotCrossed_ShallHaveCounterclockwiseOrientation2() {
		assertTrue("counterclockwise".equals(
				FootprintUtil.elasticsearchPolygonOrientation(new Double[]{2.2002, -0.5619, -1.7321, 2.2002})));
	}

	@Test
	public void testWhenDatelineNotCrossed_ShallHaveCounterclockwiseOrientation3() {
		assertTrue("counterclockwise".equals(
				FootprintUtil.elasticsearchPolygonOrientation(new Double[]{48.279240, 50.6038440, -50.958828, 48.649940})));
	}
		
	@Test
	public void testWhenDatelineCrossed_ShallHaveClockwiseOrientation1() {
		assertTrue("clockwise".equals(
				FootprintUtil.elasticsearchPolygonOrientation(new Double[]{-90.1, 90.1, 90.1, 90.1})));
		assertTrue("clockwise".equals(
				FootprintUtil.elasticsearchPolygonOrientation(new Double[]{179.9, -0.2, -0.2, 179.9})));
		assertTrue("clockwise".equals(
				FootprintUtil.elasticsearchPolygonOrientation(new Double[]{-179.9, 0.2, 0.2, -179.9})));
	}

	@Test
	public void testWhenDatelineCrossed_ShallHaveClockwiseOrientation2() {
		assertTrue("clockwise".equals(
				FootprintUtil.elasticsearchPolygonOrientation(new Double[]{170.0, 170.0, -150.0, 170.0})));
		assertTrue("clockwise".equals(
				FootprintUtil.elasticsearchPolygonOrientation(new Double[]{-170.0, -170.0, 150.0, -170.0})));
	}

	@Test
	public void testWhenDatelineCrossed_ShallHaveClockwiseOrientation3() {
		// using S1OPS-965 slice coordinates
		assertTrue("clockwise".equals(
				FootprintUtil.elasticsearchPolygonOrientation(new Double[]{177.049759, 176.350082, -179.945923, -179.415802})));
	}
	
	@Test
	public void testWhenLandmaskAntarctica_ShallHaveCounterclockwiseOriantation() {
		// Geojson coordinates from s1pdgs landmask file but with lower resolution:
		// [
		//   [-58.614142829001025, -64.15246713013323], [-67.91747677272309, -70.85391693128713],
		//   [-91.42056413447071, -73.40130666111504], [-112.29908301476269, -74.71419809992241],
		//   [-144.32203712281108, -75.53719696060277], [-148.86599829811206, -81.04337330517843],
		//   [-158.07128906249997, -85.0482847008363], [175.98567182851306, -84.15899708448774],
		//   [163.82279666570392, -75.8703032431562], [155.92979007387552, -69.14921478284289],
		//   [133.85646040256327, -66.28830413830019], [109.15863976444368, -66.8370044963753],
		//   [86.75235883987486, -67.15047373465772], [68.9291573424077, -71.06945933037653],
		//   [52.614132521378934, -66.05317637137213], [30.97173261894861, -69.75661956800155],
		//   [6.273911980828984, -70.46205454521788], [-15.407710333710867, -74.10674163833147],
		//   [-30.097097947701997, -80.5926514627287], [-76.84863705107912, -79.51493946728166],
		//   [-61.08197669131545, -72.38235076918392], [-58.614142829001025, -64.15246713013323]
		// ]

		assertTrue("counterclockwise".equals(
				FootprintUtil.elasticsearchPolygonOrientation(new Double[]{-58.614142829001025,
						-67.91747677272309, -91.42056413447071, -112.29908301476269, -144.32203712281108,
						-148.86599829811206, -158.07128906249997, 175.98567182851306, 163.82279666570392,
						155.92979007387552, 133.85646040256327, 109.15863976444368, 86.75235883987486,
						68.9291573424077, 52.614132521378934, 30.97173261894861, 6.273911980828984,
						-15.407710333710867, -30.097097947701997, -76.84863705107912, -61.08197669131545,
						-58.614142829001025})));
	}
	
	@Test
	public void testWhenLandmaskAfroeurasia_ShallHaveCounterclockwiseOriantation() {
		// Geojson coordinates from s1pdgs landmask file but with lower resolution:
		// [
		//   [106.97027587890628, 76.97430419921875], [87.16687011718759, 75.11651611328122],
		//   [75.15808105468753, 72.8551025390625], [71.28009033203134, 66.32012939453125],
		//   [67.25988769531259, 69.92871093749997], [55.44268798828128, 68.438720703125],
		//   [44.187927246093835, 67.9505004882813], [34.94390869140628, 64.41448974609372],
		//   [31.29351806640628, 70.45391845703122], [5.308288574218778, 59.66333007812503],
		//   [17.86932373046878, 58.95391845703131], [21.53607177734375, 63.18988037109375],
		//   [23.339904785156307, 59.18731689453125], [18.696289062500057, 54.43872070312503],
		//   [10.370117187500028, 56.19012451171875], [8.572082519531307, 54.39569091796875],
		//   [-1.933410644531193, 49.77648925781253], [-7.978210449218722, 43.74847412109375],
		//   [-8.898803710937472, 36.86889648437503], [-0.46710205078125, 38.29248046874997],
		//   [8.428710937500028, 44.2313232421875], [16.10931396484378, 38.9644775390625],
		//   [17.519287109375, 40.87707519531253], [13.715087890625, 45.50030517578128],
		//   [19.1624755859375, 41.955078125], [22.49011230468747, 36.41009521484381],
		//   [23.90008544921878, 39.96209716796875], [27.673889160156307, 42.57788085937503],
		//   [32.454284667968835, 45.32751464843753], [39.12127685546878, 47.26348876953131],
		//   [40.37347412109378, 41.01367187500006], [27.04888916015625, 37.65350341796881],
		//   [35.905090332031335, 35.41009521484372], [31.96051025390628, 30.933715820312557],
		//   [22.895874023437557, 32.63848876953128], [12.663330078125057, 32.79290771484381],
		//   [9.510070800781278, 37.35009765625], [-3.64007568359375, 35.39990234375],
		//   [-11.68890380859375, 28.14868164062503], [-17.02038574218747, 21.42230224609375],
		//   [-16.71368408203122, 13.595092773437486], [-13.685180664062472, 9.494873046875],
		//   [-5.834411621093693, 4.993713378906236], [5.3629150390625, 4.888122558593722],
		//   [9.291320800781278, 0.268676757812528], [12.9290771484375, -8.9591064453125],
		//   [11.73431396484375, -17.30187988281253], [17.062927246093807, -29.87597656250003],
		//   [20.689086914062557, -34.41717529296878], [30.62292480468753, -30.42370605468747],
		//   [35.45867919921878, -24.12261962890625], [38.53833007812503, -17.101013183593764],
		//   [39.19470214843753, -7.703918457031207], [42.041687011718835, -0.919189453124943],
		//   [51.111328125000085, 12.024719238281278], [43.47070312500003, 11.277709960937528],
		//   [37.862670898437585, 18.367919921875057], [32.73492431640628, 28.705322265625],
		//   [35.130310058593835, 28.0634765625], [40.24768066406253, 20.1746826171875],
		//   [43.251525878906335, 13.767700195312486], [48.67932128906253, 14.003295898437514],
		//   [56.51232910156253, 18.08709716796875], [59.45007324218753, 22.66027832031253],
		//   [54.008117675781335, 24.12188720703128], [50.52752685546878, 25.327880859375],
		//   [49.57690429687503, 29.9857177734375], [62.905700683593835, 25.21850585937503],
		//   [73.11987304687503, 17.9287109375], [79.34051513671878, 10.308898925781307],
		//   [86.49932861328128, 20.151672363281307], [92.02532958984378, 21.70172119140625],
		//   [97.77770996093753, 14.8372802734375], [100.08587646484378, 6.4644775390625],
		//   [103.33209228515628, 3.726684570312514], [100.01867675781259, 12.307128906250057],
		//   [108.36608886718759, 11.008300781250028], [109.88989257812509, 20.282470703125],
		//   [121.68450927734378, 28.22552490234375], [122.52008056640634, 36.93072509765622],
		//   [122.16870117187503, 40.42248535156253], [124.98107910156253, 37.94891357421878],
		//   [129.46832275390628, 35.63208007812503], [129.96588134765634, 41.94128417968753],
		//   [140.59747314453128, 51.23968505859375], [151.33807373046878, 59.50408935546881],
		//   [158.36431884765628, 58.05572509765628], [162.12969970703134, 56.122314453125],
		//   [173.68011474609384, 61.65270996093753], [175.72412109374997, 69.87731933593747],
		//   [157.00689697265628, 71.031494140625], [128.46008300781253, 71.9801025390625],
		//   [106.97027587890628, 76.97430419921875]
		// ]

		assertTrue("counterclockwise".equals(
				FootprintUtil.elasticsearchPolygonOrientation(new Double[]{106.97027587890628,
						87.16687011718759, 75.15808105468753, 71.28009033203134, 67.25988769531259,
						55.44268798828128, 44.187927246093835, 34.94390869140628, 31.29351806640628,
						5.308288574218778, 17.86932373046878, 21.53607177734375, 23.339904785156307,
						18.696289062500057, 10.370117187500028, 8.572082519531307, -1.933410644531193,
						-7.978210449218722, -8.898803710937472, -0.46710205078125, 8.428710937500028,
						16.10931396484378, 17.519287109375, 13.715087890625, 19.1624755859375,
						22.49011230468747, 23.90008544921878, 27.673889160156307, 32.454284667968835,
						39.12127685546878, 40.37347412109378, 27.04888916015625, 35.905090332031335,
						31.96051025390628, 22.895874023437557, 12.663330078125057, 9.510070800781278,
						-3.64007568359375, -11.68890380859375, -17.02038574218747, -16.71368408203122,
						-13.685180664062472, -5.834411621093693, 5.3629150390625, 9.291320800781278,
						12.9290771484375, 11.73431396484375, 17.062927246093807, 20.689086914062557,
						30.62292480468753, 35.45867919921878, 38.53833007812503, 39.19470214843753,
						42.041687011718835, 51.111328125000085, 43.47070312500003, 37.862670898437585,
						32.73492431640628, 35.130310058593835, 40.24768066406253, 43.251525878906335,
						48.67932128906253, 56.51232910156253, 59.45007324218753, 54.008117675781335,
						50.52752685546878, 49.57690429687503, 62.905700683593835, 73.11987304687503,
						79.34051513671878, 86.49932861328128, 92.02532958984378, 97.77770996093753,
						100.08587646484378, 103.33209228515628, 100.01867675781259, 108.36608886718759,
						109.88989257812509, 121.68450927734378, 122.52008056640634, 122.16870117187503,
						124.98107910156253, 129.46832275390628, 129.96588134765634, 140.59747314453128,
						151.33807373046878, 158.36431884765628, 162.12969970703134, 173.68011474609384,
						175.72412109374997, 157.00689697265628, 128.46008300781253, 106.97027587890628})));
	}
	
	@Test
	public void testWhenLandmaskAmerica_ShallHaveCounterclockwiseOriantation() {
		// Geojson coordinates from s1pdgs landmask file but with lower resolution:
		// [
		//   [-90.54711914062494, 69.49768066406259], [-97.66949462890616, 68.57867431640628],
		//   [-109.94610595703121, 67.98107910156253], [-125.75628662109378, 69.48071289062509],
		//   [-142.07250976562503, 69.85192871093764], [-159.0391845703125, 70.89172363281256],
		//   [-163.6525268554687, 66.57672119140628], [-160.7725219726562, 63.766113281250085],
		//   [-161.87408447265614, 59.63372802734375], [-158.6843872070312, 57.01672363281256],
		//   [-158.1171874999999, 56.46368408203139], [-150.6082153320313, 59.36828613281256],
		//   [-134.0780029296874, 58.12310791015625], [-122.97418212890615, 49.002685546875114],
		//   [-124.17877197265615, 41.142089843750085], [-118.41058349609366, 33.74090576171875],
		//   [-114.4656982421874, 27.14208984375003], [-109.40911865234365, 23.364685058593892],
		//   [-113.42401123046866, 28.826293945312557], [-111.75958251953118, 28.46807861328128],
		//   [-105.26580810546866, 21.42211914062503], [-98.94769287109374, 16.566101074218864],
		//   [-89.81237792968741, 13.520690917968906], [-86.05841064453116, 11.403503417968878],
		//   [-83.90991210937494, 9.2908935546876], [-80.88641357421872, 7.220520019531392],
		//   [-78.21490478515622, 7.512329101562628], [-78.85528564453122, 1.380920410156335],
		//   [-81.41088867187491, -4.736694335937486], [-71.46197509765616, -17.363403320312457],
		//   [-73.1666870117187, -37.123779296874915], [-74.12658691406247, -46.93920898437494],
		//   [-68.57147216796866, -52.29937744140623], [-65.32879638671866, -44.501281738281236],
		//   [-62.335876464843665, -38.82769775390615], [-54.93579101562497, -34.95257568359378],
		//   [-46.47210693359369, -24.08898925781253], [-38.67388916015619, -13.057678222656222],
		//   [-41.47259521484372, -2.911987304687443], [-51.06970214843747, 3.650512695312628],
		//   [-58.48291015624997, 7.347717285156378], [-65.65521240234375, 10.200927734375128],
		//   [-71.69561767578116, 9.072326660156364], [-74.2766723632812, 11.10211181640635],
		//   [-79.9146118164062, 9.312683105468892], [-83.65087890624991, 11.629089355468821],
		//   [-84.06298828124994, 15.648315429687642], [-87.90179443359366, 15.864501953125028],
		//   [-88.10681152343741, 18.348693847656335], [-89.60131835937491, 21.26171875000003],
		//   [-97.1892700195312, 20.635498046875], [-96.59399414062494, 28.307495117187557],
		//   [-89.60491943359372, 30.176330566406307], [-82.23999023437489, 26.73010253906253],
		//   [-81.33630371093741, 31.44049072265628], [-76.9600219726562, 38.23291015625],
		//   [-74.98040771484372, 39.19647216796872], [-71.1203002929687, 41.49450683593753],
		//   [-67.13739013671872, 45.13751220703125], [-64.47210693359366, 46.238525390625085],
		//   [-63.86248779296872, 50.291076660156364], [-61.798583984374915, 56.339477539062614],
		//   [-72.90850830078116, 62.1051025390625], [-79.82958984374991, 54.66772460937514],
		//   [-89.03948974609372, 56.8516845703125], [-87.32318115234366, 64.77569580078136],
		//   [-90.54711914062494, 69.49768066406259]
		// ]

		assertTrue("counterclockwise".equals(
				FootprintUtil.elasticsearchPolygonOrientation(new Double[]{-90.54711914062494,
						-97.66949462890616, -109.94610595703121, -125.75628662109378, -142.07250976562503,
						-159.0391845703125, -163.6525268554687, -160.7725219726562, -161.87408447265614,
						-158.6843872070312, -158.1171874999999, -150.6082153320313, -134.0780029296874,
						-122.97418212890615, -124.17877197265615, -118.41058349609366, -114.4656982421874,
						-109.40911865234365, -113.42401123046866, -111.75958251953118, -105.26580810546866,
						-98.94769287109374, -89.81237792968741, -86.05841064453116, -83.90991210937494,
						-80.88641357421872, -78.21490478515622, -78.85528564453122, -81.41088867187491,
						-71.46197509765616, -73.1666870117187, -74.12658691406247, -68.57147216796866,
						-65.32879638671866, -62.335876464843665, -54.93579101562497, -46.47210693359369,
						-38.67388916015619, -41.47259521484372, -51.06970214843747, -58.48291015624997,
						-65.65521240234375, -71.69561767578116, -74.2766723632812, -79.9146118164062,
						-83.65087890624991, -84.06298828124994, -87.90179443359366, -88.10681152343741,
						-89.60131835937491, -97.1892700195312, -96.59399414062494, -89.60491943359372,
						-82.23999023437489, -81.33630371093741, -76.9600219726562, -74.98040771484372,
						-71.1203002929687, -67.13739013671872, -64.47210693359366, -63.86248779296872,
						-61.798583984374915, -72.90850830078116, -79.82958984374991, -89.03948974609372,
						-87.32318115234366, -90.54711914062494})));
	}
	
	@Test
	public void testWhenLandmaskGreenland_ShallHaveCounterclockwiseOriantation() {
		// Geojson coordinates from s1pdgs landmask file but with lower resolution:
		// [
		//   [-27.10046, 83.51966], [-53.04328, 81.88833], [-69.37345, 78.91388], [-61.26861, 76.10238],
		//   [-51.39014, 70.56978000000012], [-52.9804, 68.35759], [-44.7875, 60.03676], [-36.35284, 65.9789],
		//   [-25.54341, 71.43094], [-22.17221, 73.30955], [-19.67353, 77.63859], [-23.169609999999892, 81.15271],
		//   [-27.10046, 83.51966]
		// ]

		assertTrue("counterclockwise".equals(
				FootprintUtil.elasticsearchPolygonOrientation(new Double[]{-27.10046, -53.04328, -69.37345,
						-61.26861, -51.39014, -52.9804, -44.7875, -36.35284, -25.54341, -22.17221, -19.67353,
						-23.169609999999892, -27.10046})));
	}

	public void testMaxDifference() {
		Double[] input = new Double[] { 2.2, 22.5, -180.0, 70.0, 180.5 };
		Double expected = 360.5;
		assertEquals(expected, FootprintUtil.maxDifference(input));
	}
}
